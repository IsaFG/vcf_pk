############## [INFO] SCRIPT 2.2 General information ############
# This script will extract structural information from SWAGGER CELL BASE,
# in order to obtain parameters fields of a particular path.
# With this information, the goal is to create another script for TIBCO
# to ask the user which information he wants to retrieve from CELLBASE for a particular option.

############## [INFO] Input and Output ############################
# Input :
# 1) The path chosen by the user (the path would be provided by TIBCO)
# 2) We will work with the resource list, which is the main JSON of the CellBase
# "http://bioinfo.hpc.cam.ac.uk/cellbase/webservices/rest/swagger.json

# Output : a table with the paramaters of a particular chosen path

############## [INFO] Path example used in this script ############################
# Retreive info from VARIANT ANNOTATION GET LINK
# This is the link :
# GET /{version}/{species}/genomic/variant/{variants}/annotation

# Implementation Notes :
# Include and exclude lists take values from the following set:
# {variation, clinical, conservation, functionalScore, consequenceType,
# expression, geneDisease, drugInteraction, populationFrequencies, repeats}

# Response Class (Status 200) :
# For informative purpose, all the responses sections of the example link
# are in the following json :
# variant_annotation_Response_Class.json

# ############# [FACULTATIVE] Install libraries ###################
# install.packages("RCurl")
# install.packages("jsonlite")
# 
# # The follwing packages are for 
# install.packages('purrr')
# install.packages('tidyverse')
# install.packages('rjson')

# ############# [FACULTATIVE] Set Working directory ############
# setwd("C:\\Users\\FollonIn\\Documents\\GitHub\\vcf_pk")

########### Load RinR library #############
library(RinR)

########### Determinate R interpreter location ########
Rversion <- makeREvaluator("R", RHome = "C:/Program Files/R/R-3.4.1")

param_mtrx <- REvaluate({
  ############# [CODE] Load libraries ###################
  library(RCurl)
  library(jsonlite)
  
  # For map function
  library(purrr)
  library(tidyverse)
  library(rjson)
  
  ############# [CODE] Get the main Swagger.json from CELLBASE ###############
  swagger_URL <- getURL("http://bioinfo.hpc.cam.ac.uk/cellbase/webservices/rest/swagger.json")
  swagger_JSON <-fromJSON(swagger_URL)
  
  ############# [INFO] [NOT STARTED] Ask the user to choose a particular GET (path) ###############
  # This part will be done in Spotify (TIBCO)
  # The path chosen by User would be stored in a variable :
  # In this DRAFT, we will use the path "variant annotation" as an example.
  chosen_path <- '/{version}/{species}/genomic/variant/{variants}/annotation'
  
  ############# [CODE] [IN PROGRESS] Get the filter parameters from a particular path ###############
  # The idea would be to reach the "parameters" level
  # to retrieve all the paramater for a particular given link
  # In this DRAFT, we will use a specific path as an example.
  # But the idea would be that the USER itself would choose the path he wants
  # and then the script will return the availables parameters.
  
  # Create a list with the paths and their content:
  paths_JSON <- swagger_JSON$paths
  # paths_JSON # this line is for testing
  
  # Create a list with all the content of the chosen path
  var_annot_path <- paths_JSON[[paste(chosen_path)]]
  
  # map(var_annot_path, names) # this line is for testing
  parameters_list <- var_annot_path$get$parameters
  # parameters_list # this line is for testing
  param_list_length <- length(parameters_list)
  
  # Extract columns of interest from parameters dataframe
  param_name_vector <- parameters_list$name
  param_descr_vector <- parameters_list$des

  param_mtrx <- cbind(param_name_vector, param_descr_vector)
  param_mtrx <- data.frame(param_mtrx)
  param_mtrx
}
,
# provide the path chosen by the user
data = list(chosen_path = SelectedPath)
# ,
# REvaluator = Rversion
# ,
# verbose	= TRUE
)

paramTable <- param_mtrx